import VRP
import readers
import time
from gurobiHandler import vrpSolver
import csv

class vrpRunner:
    
    def __init__(self,readerType):
        if readerType == "solomon":
            self.reader = readers.solomonFileReader()
        else:
            raise Exception("illegal reader type: " + readerType)
    
    def generateAndSolveInstance(self,fileName,buildParam,runParam,maxConfSize):
        data = self.reader.readFile(fileName)
        vrp = VRP.VRP(data["nTrucks"], data["capacity"], data["targets"])
        t1 = time.time()
        confs = vrp.bfsConfBuilderWrapper(buildParam, runParam, maxConfSize)
        t2 = time.time()
        s = vrpSolver(confs, vrp)
        s.buildIP()
        [nVehicles,totalDistance] = s.solve()
        t3 = time.time()
        return {'nVehicles' : nVehicles, 'totalDistance':totalDistance,'confBuildTime': t2 - t1, 'solverTime': t3 - t2,"fileName":fileName,\
                "buildParam":buildParam,"runParam":runParam,"maxConfSize":maxConfSize}

class filePrinter:
    
    def __init__(self):
        pass
    
    def printRes(self,allRes,filename):
        csvfile = open(filename, 'wb')
        fieldnames = allRes[0].keys()
        writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
        writer.writeheader()
        writer.writerows(allRes)
        csvfile.close

class bestSols:
    def __init__(self):
        # data taken from 
        self.all25Data = [{"C101":[3,191.3]},{"C201":[2,214.7]},{"C102":[3,190.3]},{"C202":[2,214.7]},{"C103":[3,190.3]},{"C203":[2,214.7]},\
                    {"C104":[3,186.9]},{"C204":[1,213.1]},{"C105":[3,191.3]},{"C205":[2,214.7]},{"C106":[3,191.3]},{"C206":[2,214.7]},\
                    {"C107":[3,191.3]},{"C207":[2,214.5]},{"C108":[3,191.3]},{"C208":[2,214.5]},{"C109":[3,191.3]},{"R101":[8,617.1]},\
                    {"R201":[4,463.3]},{"R102":[7,547.1]},{"R202":[4,410.5]},{"R103":[5,454.6]},{"R203":[3,391.4]},{"R104":[4,416.9]},\
                    {"R204":[2,355.0]},{"R105":[6,530.5]},{"R205":[3,393.0]},{"R106":[5,465.4]},{"R206":[3,374.4]},{"R107":[4,424.3]},\
                    {"R207":[3,361.6]},{"R108":[4,397.3]},{"R208":[1,328.2]},{"R109":[5,441.3]},{"R209":[2,370.7]},{"R110":[4,444.1]},\
                    {"R210":[3,404.6]},{"R111":[4,428.8]},{"R211":[2,350.9]},{"R112":[4,393.0]},{"RC101":[4,461.1]},{"RC201":[3,360.2]},\
                    {"RC102":[3,351.8]},{"RC202":[3,338.0]},{"RC103":[3,332.8]},{"RC203":[3,326.9]},{"RC104":[3,306.6]},{"RC204":[3,299.7]},\
                    {"RC105":[4,411.3]},{"RC205":[3,338.0]},{"RC106":[3,345.5]},{"RC206":[3,324.0]},{"RC107":[3,298.3]},{"RC207":[3,298.3]},\
                    {"RC108":[3,294.5]},{"RC208":[2,269.1]}]
        self.all50Data = [{"C101":[5,362.4]},{"C201":[3,360.2]},{"C102":[5,361.4]},{"C202":[3,360.2]},{"C103":[4,361.4]},{"C203":[3,359.8]},\
                    {"C104":[5,359.0]},{"C204":[2,353.4]},{"C105":[5,362.4]},{"C205":[3,359.8]},{"C106":[5,362.4]},{"C206":[3,359.8]},\
                    {"C107":[5,362.4]},{"C207":[3,359.6]},{"C108":[5,362.4]},{"C208":[2,350.5]},{"C109":[5,362.4]},{"R101":[13,1047.0]},{"C201":[6,800.7]},\
                    {"R102":[12,944.9]},{"C202":[5,712.2]},{"R103":[9,772.9]},{"C203":[5,606.4]},{"R104":[6,631.2]},{"C204":[2,509.5]},{"R105":[10,906.6]},{"C205":[5,703.3]},\
                    {"R106":[8,793.6]},{"C206":[5,647.0]},{"R107":[7,720.4]},{"C207":[4,584.6]},{"R108":[6,618.2]},{"C208":[2,487.7]},{"R109":[8,803.2]},{"C209":[4,600.6]},\
                    {"R110":[8,724.9]},{"C210":[5,663.4]},{"R111":[8,724.9]},{"C211":[3,551.3]},{"R112":[6,651.1]},{"RC101":[9,957.9]},{"RC201":[5,684.8]},\
                    {"RC102":[8,844.3]},{"RC202":[5,613.6]},{"RC103":[6,712.6]},{"RC203":[4,555.3]},{"RC104":[5,546.5]},{"RC204":[3,444.2]},{"RC105":[9,888.9]},{"RC205":[5,631.0]},\
                    {"RC106":[7,791.9]},{"RC206":[5,610.0]},{"RC107":[6,664.5]},{"RC207":[4,558.6]},{"RC108":[6,598.1]},{"RC208":[100,10000]}]
        self.all100Data = [{"C101":[10,827.3]},{"C102":[10,827.3]},{"C103":[10,826.3]},{"C104":[10,822.9]},{"C105":[10,827.3]},{"C106":[10,827.3]},{"C107":[10,827.3]},\
                    {"C108":[10,827.3]},{"C109":[10,827.3]},{"R101":[20,1637.7]},{"R102":[18,1466.6]},{"R103":[14,1208.7]},{"R104":[10,982.01]},{"R105":[15,1355.3]},\
                    {"R106":[13,1234.6]},{"R107":[11,1064.6]},{"R108":[9,960.88]},{"R109":[13,1146.9]},{"R110":[12,1068]},{"R111":[12,1048.7]},{"R112":[9,982.14]},\
                    {"RC101":[15,1619.8]},{"RC102":[14,1457.4]},{"RC103":[11,1258]},{"RC104":[10,1135.48]},{"RC105":[15,1513.7]},{"RC106":[11,1424.73]},\
                    {"RC107":[11,1230.48]},{"RC108":[10,1139.82]}]
        